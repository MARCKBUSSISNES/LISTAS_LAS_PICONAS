<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TRASLADOS LAS PICONAS</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
<style>
body {
  font-family: 'Arial', sans-serif;
  background:#121212 url('FONDO PARA LISTA.jpg') no-repeat center center fixed;
  background-size:cover;
  color:#fff;
  margin:0;
  padding:0;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:20px;
  background:#000;
  position: relative;
}
#logo{
  width:500px;
  height:auto;
}
header h1{
  font-size:2rem;
  color:#25D366;
  text-align:center;
  flex:1;
}
#currentDate{
  position:absolute;
  top:5px;
  right:10px;
  font-family: 'digital-7', monospace;
  font-size:1rem;
}
.container{
  max-width:900px;
  margin:auto;
  padding:20px;
}
.form-group{
  display:flex;
  gap:10px;
  margin-bottom:12px;
  flex-wrap:wrap;
}
select, input{
  padding:10px;
  border-radius:8px;
  border:none;
  font-size:1rem;
  flex:1;
}
input[type=number]{width:100px;}
button{
  padding:12px 18px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
  font-size:1rem;
}
#addBtn{background:#25D366;color:#fff;}
#sendJuanBtn{background:#000;color:#25D366;}
#cleanBtn{
  width:40px; height:40px;
  border-radius:50%;
  border:2px solid #25D366;
  background:transparent;
  color:#25D366;
  font-weight:bold;
  transition:0.3s;
}
#cleanBtn:hover{background:#25D366; color:#000;}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
table, th, td{border:1px solid #444;}
th, td{padding:6px; text-align:center; font-size:1.1rem;}
label{font-size:0.9rem;}
</style>
</head>
<body>

<header>
  <img src="LOGO1 (2).png" alt="Logo" id="logo">
  <h1>REGISTRO DE PRODUCTOS PARA TRASLADO</h1>
  <div id="currentDate"></div>
</header>

<div class="container">
  <div class="form-group">
    <input type="text" id="productName" placeholder="Nombre del producto">
    <input type="number" id="productQty" placeholder="Cantidad">
    <input type="text" id="productUnit" placeholder="Unidad de medida">
    <select id="productSupplier">
      <option value="">Proveedor</option>
      <option value="PP">PP</option>
      <option value="AP">AP</option>
      <option value="SC">SC</option>
      <option value="RS">RS</option>
      <option value="TERM">TERM</option>
      <option value="PRC">PRC</option>
    </select>
    <button id="addBtn">Agregar</button>
    <button id="cleanBtn">üóë</button>
  </div>

  <table id="itemsTable">
    <thead>
      <tr>
        <th>Producto</th>
        <th>Cantidad</th>
        <th>Unidad</th>
        <th>Proveedor</th>
        <th>Recibido</th>
        <th>Borrar</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="form-group" style="margin-top:15px;">
    <input type="text" id="operator" placeholder="Qui√©n realiza el procedimiento">
    <select id="branch">
      <option value="">Sucursal</option>
      <option value="Roosevelt">Roosevelt</option>
      <option value="SanCristobal">San Cristobal</option>
      <option value="AtlanticPlaza">Atlantic Plaza</option>
    </select>
    <button id="generatePDF">Generar PDF</button>
    <button id="sendJuanBtn">Enviar a Juan Luis</button>
  </div>
</div>

<audio id="addSound" src="https://www.soundjay.com/buttons/sounds/button-16.mp3"></audio>

<script>
const items = [];
const tbody = document.querySelector('#itemsTable tbody');
const currentDateEl = document.getElementById('currentDate');
const addSound = document.getElementById('addSound');

function updateDate(){
  const now = new Date();
  currentDateEl.textContent = now.toLocaleString();
}
updateDate();
setInterval(updateDate, 1000);

function renderTable(){
  tbody.innerHTML='';
  items.forEach((it,index)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${it.name}</td>
                    <td>${it.qty}</td>
                    <td>${it.unit}</td>
                    <td>${it.supplier}</td>
                    <td>[ ]</td>
                    <td><button onclick="deleteItem(${index})">‚ùå</button></td>`;
    tbody.appendChild(tr);
  });
}

function deleteItem(index){
  items.splice(index,1);
  renderTable();
}

document.getElementById('addBtn').addEventListener('click', ()=>{
  const name = document.getElementById('productName').value.trim();
  const qty = document.getElementById('productQty').value;
  const unit = document.getElementById('productUnit').value.trim();
  const supplier = document.getElementById('productSupplier').value;
  if(!name || !qty || !supplier){ alert('Complete todos los campos'); return; }
  items.push({name, qty, unit, supplier});
  renderTable();
  addSound.play();
  document.getElementById('productName').value='';
  document.getElementById('productQty').value='';
  document.getElementById('productUnit').value='';
  document.getElementById('productName').focus();
});

document.getElementById('productName').addEventListener('keypress', (e)=>{
  if(e.key==='Enter'){ document.getElementById('addBtn').click(); }
});

document.getElementById('cleanBtn').addEventListener('click', ()=>{
  if(confirm("¬øDesea limpiar toda la lista?")){
    items.length=0;
    renderTable();
  }
});

document.getElementById('generatePDF').addEventListener('click', ()=>{
  if(items.length===0){ alert('No hay productos'); return; }
  const operator = document.getElementById('operator').value.trim();
  const branch = document.getElementById('branch').value;
  if(!branch){ alert('Seleccione sucursal'); return; }
  if(!operator){ alert('Ingrese qui√©n realiza el procedimiento'); return; }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:'mm', format:[80, 3000]}); // 80mm ancho

  let y=10;
  const logoImg = new Image();
  logoImg.src='LOGO1 (2).png';
  logoImg.onload = ()=>{
    doc.addImage(logoImg,'PNG',10,y,60,35);
    y+=38;

    const now = new Date();
    doc.setFontSize(10);
    doc.text(`Sucursal: ${branch}`, 40, y, {align:'center'});
    doc.text(`Fecha: ${now.toLocaleDateString()} ${now.toLocaleTimeString()}`,70,10,{align:'right'});
    y+=6;
    doc.text(`Qui√©n realiza: ${operator}`,40,y,{align:'center'});
    y+=6;

    doc.autoTable({
      startY: y,
      theme:'grid',
      head: [['Producto','Cantidad','Unidad','Proveedor','Recibido']],
      body: items.map(it=>[it.name,it.qty,it.unit,it.supplier,'[ ]']),
      styles:{ fontSize:9, cellPadding:1 },
      margin:{left:2,right:2},
      tableWidth: 'auto'
    });

    y = doc.lastAutoTable.finalY + 10;

    // Observaciones con l√≠neas m√°s largas
    doc.text('Observaciones:',40,y,{align:'center'}); y+=6;
    for(let i=0;i<3;i++){
      doc.text('______________________________',40,y,{align:'center'});
      y+=8;
    }

    // Firmas con l√≠neas largas
    doc.text('Firma de quien recibe:',40,y,{align:'center'}); y+=6;
    doc.text('______________________________',40,y,{align:'center'}); y+=8;
    doc.text('Nombre de quien recibe:',40,y,{align:'center'}); y+=6;
    doc.text('______________________________',40,y,{align:'center'}); y+=8;
    doc.text('Firma de quien entrega:',40,y,{align:'center'}); y+=6;
    doc.text('______________________________',40,y,{align:'center'}); y+=12;

    // Texto final SI/NO
    doc.text('Se reciben correctamente todos los productos:',40,y,{align:'center'});
    y+=6;
    doc.rect(20,y,6,6); doc.text('SI',28,y+5);
    doc.rect(45,y,6,6); doc.text('NO',53,y+5);
    y+=12;

    // Pie de p√°gina MarckBusiness
    doc.setFontSize(8);
    doc.text('MarckBusiness ¬© 2025 ‚Äî Todos los derechos reservados',40,y,{align:'center'});

    doc.save('ListaProductos.pdf');

    // Abrir WhatsApp seg√∫n sucursal
    let number='';
    if(branch==='Roosevelt') number='51330598';
    if(branch==='SanCristobal') number='39161962';
    if(branch==='AtlanticPlaza') number='36704724';
    if(number) window.open(`https://wa.me/${number}`,'_blank');
  }
});

document.getElementById('sendJuanBtn').addEventListener('click', ()=>{
  window.open('https://wa.me/58140621','_blank');
});
</script>
</body>
</html>
